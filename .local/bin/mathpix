#!/usr/bin/env bash
# vim: set ft=sh:
MATHPIX_ID="$(awk 'NR==2' < "${HOME}"/.api_keys/MATHPIX)"
MATHPIX_KEY="$(awk 'NR==3' < "${HOME}"/.api_keys/MATHPIX)"
SCREENSHOT_PROG="maim -s"
BASE64_PROG="base64 -w 0"
image_file=/tmp/screenshot
rm -f "$image_file"
${SCREENSHOT_PROG} "${image_file}"
[[ ! -f "$image_file" ]] && exit 1
image=$(${BASE64_PROG} "${image_file}")
mode="text"
curl -q \
    https://api.mathpix.com/v3/"${mode}" \
    -X POST \
    -H "app_id: ${MATHPIX_ID}" \
    -H "app_key: ${MATHPIX_KEY}" \
    -H "Content-Type: application/json" \
    --data "{\"math_inline_delimiters\": [\"$\$\", \"$\$\"],\"rm_spaces\": true,\"src\":\"data:image/jpeg;base64,'$image'\"}" \
    2> /dev/null | jq -r ."$mode" | xsel -b 
