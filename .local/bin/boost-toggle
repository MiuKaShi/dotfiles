#!/bin/sh

# change /usr/bin/tlp /usr/bin/tlp-stat to run with NOPASSWD

LIST_STAT=('Enabled' 'Disabled')
cstat=${LIST_STAT[$(cat /sys/devices/system/cpu/intel_pstate/no_turbo)]}

boost_notify(){
speed="$(cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq)"
speed="$(echo "${speed}" | awk '{ OFMT="%.2fGhz"; print $1 / 1000000 }')"
TITLE="Turbo Boost ${stat}"
MSG="Current max frequency: ${speed}"
notify-send -i device_cpu -t 5000 \
        "${TITLE}" \
        "${MSG}"
}

mode=$(printf "ðŸ’» Disabled\nðŸš€ Enabled" | dmenu -i -p "Boost toggle:")
if [ "$mode" = "ðŸ’» Disabled" ]; then
    stat="Disabled"
    if [ "$cstat" != "$stat" ]; then
        sudo -n tlp start -- CPU_BOOST_ON_BAT=0 CPU_BOOST_ON_AC=0
        boost_notify
    fi
elif [ "$mode" = "ðŸš€ Enabled" ]; then
    stat="Enabled"
    if [ "$cstat" != "$stat" ]; then
        sudo -n tlp start -- CPU_BOOST_ON_BAT=1 CPU_BOOST_ON_AC=1
        boost_notify
    fi
else
    exit 0
fi

