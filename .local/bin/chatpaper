#!/bin/sh

# first use conda to create a python env and
# pip install arxiv PyMuPDF requests tiktoken tenacity pybase64 Pillow openai markdown gradio"

# get pdf
file=$(readlink -f "$1")
name=$(basename "$file")
fname="${name%.*}"
output_dir="/home/miuka/.cache/chatpaper"
[ ! -d "$output_dir" ] && mkdir "$output_dir"
output_file="$output_dir/$fname.md"

# env setting
cd ~/.config/script/chatpaper || exit
source /etc/profile.d/conda.sh
conda activate jupyterlab-env

python chat_paper.py --pdf_path "$file" >"$output_file"
prettier --loglevel=silent --write "$output_file"
st -e "$EDITOR" "$output_file"
