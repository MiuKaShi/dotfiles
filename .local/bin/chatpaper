#!/bin/sh

# Set variables
input_file=$(readlink -f "$1")
input_file_name=$(basename "$input_file")
output_dir="/home/miuka/papers/chatpaper"
output_file="$output_dir/${input_file_name%.*}.md"

# Create output directory if it doesn't exist
if [ ! -d "$output_dir" ]; then
    mkdir "$output_dir"
fi

# Generate summary if output file doesn't exist
if [ ! -e $output_file ]; then
    # Set environment variables
    cd ~/.config/script/chatpaper || exit
    source ~/.config/mamba/mamba_env.sh
    micromamba activate chatgpt_env

    # Notify user that summary is being generated
    notify-send -t 6000 "Chatpaper" "Waiting for GPT summary"

    # Generate summary and save to output file
    python chat_paper.py --pdf_path "$input_file" >"$output_file"
fi

# Open output file in editor
st -e "$EDITOR" "$output_file"
