#!/bin/sh

# Get the absolute path of the input file
input_file=$(readlink -f "$1")

# Extract the name and directory of the input file
file_name=$(basename "$input_file")
file_name_without_extension="${file_name%.*}"
directory=${input_file%/*}

# Change to the directory of the input file
cd "$directory" || exit 1

# Check if a bibtex file already exists for the input file
if [ ! -f "$file_name_without_extension.bib" ]; then
    # If not, create one using an API and save it in the same directory as the input file
    curl -v -H "Accept: application/x-bibtex" --form input=@"$input_file" --form consolidateCitations=1 https://bib.miukashi.xyz/api/processReferences >"$file_name_without_extension.bib"
    notify-send -t 3000 "Bibtex" "Bibtex file created"
fi

# Convert the bibtex file to HTML using bib2html and save it in the same directory as the input file
bib2html "$directory/$file_name_without_extension.bib"
