#!/usr/bin/env bash

host="https://sci-hub.se"

input="$1"
start=$(echo "$input" | cut -c -3)

if [ "$start" = "htt" ]; then
    link="$host/$input"
else
    if [ "$start" = "doi" ] || [ "$start" = "DOI" ]; then
        doi=$(echo "$input" | cut -d ":" -f2)
        link="$host/$doi"
    else
        link="$host/$input"
    fi
fi

sci_hub=$(wget "$link" -qO -)
pdfurl="https:$(echo "$sci_hub" | grep -Eom1 '//[^ ]+\.pdf')"
pdfname=$(basename "$pdfurl")

echo "$pdfurl"
wget --no-check-certificate --header="Accept: text/html" --user-agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10.8; rv:21.0) Gecko/20100101 Firefox/21.0" --referer "$host" "$pdfurl" --quiet

if [ -f "$pdfname" ]; then
    echo "Downloaded $pdfname"
else
    echo "Download failed"
fi

exit 0
